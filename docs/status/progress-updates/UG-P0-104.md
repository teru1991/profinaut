# UG-P0-104 â€” Commands UI: reason + confirm + expiry (capabilities-driven)

## Summary
- Added command-safety inputs to the Commands page: `reason` and `expires_at` (`datetime-local`).
- Added a capabilities-driven UI policy parser that enables strict validation only when capabilities indicate enforcement.
- Added a two-step confirmation modal before PAUSE/RESUME execution.
- Updated command request payload construction to include `reason` and `expires_at` (in `payload`) when provided.
- Added a web API proxy route for `/api/capabilities` with a safe fallback policy (`enforced=false`) when upstream is unavailable.

## Manual verification steps
1. Open the web app and navigate to `/commands`.
2. Verify `Reason` and `Expires At` inputs are visible.
3. If capabilities indicate command safety enforcement (`reason_required` or `enforced`), confirm:
   - PAUSE/RESUME buttons remain disabled until `reason` is non-empty.
   - `Expires At` must be set to a future timestamp.
4. If capabilities are absent/unknown/not enforcing, confirm:
   - PAUSE/RESUME buttons are usable without reason/expiry.
   - Optional reason/expiry can still be entered.
5. Click `PAUSE` or `RESUME` and verify a modal appears showing:
   - command type
   - target bot ID
   - warning text
6. Confirm that execution requires two confirm clicks:
   - first click arms confirmation (1/2)
   - second click executes (2/2)
7. Check network request body for `POST /api/commands` and verify `payload.reason` and `payload.expires_at` are sent when provided.

## Local build/test commands
Run from `apps/web`:
- `npm run build`
- `npx tsc --noEmit`
- `npx next lint`
